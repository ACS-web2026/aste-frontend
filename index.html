<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piattaforma Aste Immobiliari</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Configurazione
        const API_URL = 'https://aste-backend.onrender.com';
        const MASTER_PASSWORD = 'aste2025';

        // State globale
        let state = {
            isAuthenticated: false,
            password: '',
            showPassword: false,
            activeTab: 'search',
            isLoading: false,
            searchStatus: '',
            filters: { comune: '', tipologia: '', prezzoMin: '', prezzoMax: '' },
            clients: [],
            searchResults: [],
            clientMatches: []
        };

        // Render app
        function render() {
            const app = document.getElementById('app');
            
            if (!state.isAuthenticated) {
                app.innerHTML = renderLogin();
            } else {
                app.innerHTML = renderMain();
            }
            
            attachEventListeners();
        }

        function renderLogin() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                        <div class="flex items-center justify-center mb-6">
                            <svg class="w-12 h-12 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">
                            Piattaforma Aste Immobiliari
                        </h1>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password di accesso</label>
                            <div class="relative">
                                <input 
                                    type="${state.showPassword ? 'text' : 'password'}"
                                    id="password-input"
                                    value="${state.password}"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Inserisci password"
                                />
                                <button 
                                    id="toggle-password"
                                    type="button"
                                    class="absolute right-3 top-2.5 text-gray-500"
                                >
                                    üëÅÔ∏è
                                </button>
                            </div>
                        </div>
                        <button 
                            id="login-btn"
                            class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                        >
                            Accedi
                        </button>
                        <p class="text-xs text-gray-500 text-center mt-4">Solo per uso interno autorizzato</p>
                    </div>
                </div>
            `;
        }

        function renderMain() {
            return `
                <div class="min-h-screen bg-gray-50">
                    <!-- Header -->
                    <div class="bg-indigo-600 text-white shadow-lg">
                        <div class="max-w-7xl mx-auto px-4 py-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h1 class="text-2xl font-bold">Monitoraggio Aste Giudiziarie</h1>
                                    <p class="text-xs text-indigo-200">Server: üü¢ Cloud ‚Ä¢ ${API_URL}</p>
                                </div>
                                <button id="logout-btn" class="bg-indigo-700 hover:bg-indigo-800 px-4 py-2 rounded-lg">
                                    Esci
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="bg-white border-b">
                        <div class="max-w-7xl mx-auto px-4">
                            <div class="flex space-x-8">
                                <button 
                                    id="tab-search"
                                    class="py-4 px-2 border-b-2 font-medium ${state.activeTab === 'search' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500'}"
                                >
                                    üîç Ricerca Istantanea
                                </button>
                                <button 
                                    id="tab-clients"
                                    class="py-4 px-2 border-b-2 font-medium ${state.activeTab === 'clients' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-500'}"
                                >
                                    üë• Monitoraggio Clienti (${state.clients.length})
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="max-w-7xl mx-auto px-4 py-6">
                        ${state.activeTab === 'search' ? renderSearchTab() : renderClientsTab()}
                    </div>
                </div>
            `;
        }

        function renderSearchTab() {
            return `
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">üîç Filtri di Ricerca</h2>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <input 
                                id="filter-comune"
                                type="text" 
                                placeholder="Comune"
                                value="${state.filters.comune}"
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <select 
                                id="filter-tipologia"
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            >
                                <option value="">Tutte le tipologie</option>
                                <option value="Appartamento">Appartamento</option>
                                <option value="Villa">Villa</option>
                                <option value="Garage">Garage</option>
                                <option value="Terreno">Terreno</option>
                            </select>
                            <input 
                                id="filter-prezzo-min"
                                type="number" 
                                placeholder="Prezzo minimo (‚Ç¨)"
                                value="${state.filters.prezzoMin}"
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <input 
                                id="filter-prezzo-max"
                                type="number" 
                                placeholder="Prezzo massimo (‚Ç¨)"
                                value="${state.filters.prezzoMax}"
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <button 
                                id="search-btn"
                                ${state.isLoading ? 'disabled' : ''}
                                class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors ${state.isLoading ? 'opacity-50 cursor-not-allowed' : ''}"
                            >
                                ${state.isLoading ? '‚è≥ Ricerca...' : 'üîÑ Aggiorna'}
                            </button>
                        </div>
                        ${state.searchStatus ? `<p class="mt-3 text-sm text-indigo-600">‚ÑπÔ∏è ${state.searchStatus}</p>` : ''}
                        <p class="text-sm text-gray-500 mt-3">Monitoraggio su 7 portali di aste</p>
                    </div>

                    ${state.searchResults.length > 0 ? `
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold">Trovati ${state.searchResults.length} risultati</h3>
                            ${state.searchResults.map(r => renderResultCard(r)).join('')}
                        </div>
                    ` : !state.isLoading ? `
                        <div class="bg-white rounded-lg shadow p-12 text-center">
                            <p class="text-gray-500">Clicca "Aggiorna" per iniziare la ricerca</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderClientsTab() {
            return `
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">üë• Gestione Clienti</h2>
                    <p class="text-gray-600">Funzionalit√† in sviluppo - gestione clienti e comuni limitrofi</p>
                </div>
            `;
        }

        function renderResultCard(result) {
            return `
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800">${result.tipologia}</h3>
                            <p class="text-gray-600 mt-1">üìç ${result.indirizzo}, ${result.comune}</p>
                            <span class="inline-block mt-1 text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                                Fonte: ${result.fonte}
                            </span>
                        </div>
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ‚Ç¨${result.prezzo.toLocaleString()}
                        </span>
                    </div>
                    <p class="text-gray-600 mb-3">${result.descrizione}</p>
                    <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                        <div class="text-gray-600">üìÖ Asta: ${result.dataAsta}</div>
                        <div class="text-gray-600">üè† ${result.tipologia}</div>
                    </div>
                    <a 
                        href="${result.link}" 
                        target="_blank"
                        class="text-indigo-600 hover:text-indigo-800 text-sm font-medium inline-flex items-center"
                    >
                        üîó Visualizza annuncio ‚Üí
                    </a>
                </div>
            `;
        }

        function attachEventListeners() {
            // Login
            const loginBtn = document.getElementById('login-btn');
            const passwordInput = document.getElementById('password-input');
            const togglePassword = document.getElementById('toggle-password');
            
            if (loginBtn) {
                loginBtn.onclick = handleLogin;
            }
            if (passwordInput) {
                passwordInput.oninput = (e) => {
                    state.password = e.target.value;
                };
                passwordInput.onkeypress = (e) => {
                    if (e.key === 'Enter') handleLogin();
                };
            }
            if (togglePassword) {
                togglePassword.onclick = () => {
                    state.showPassword = !state.showPassword;
                    render();
                };
            }

            // Main app
            const logoutBtn = document.getElementById('logout-btn');
            const tabSearch = document.getElementById('tab-search');
            const tabClients = document.getElementById('tab-clients');
            const searchBtn = document.getElementById('search-btn');
            
            if (logoutBtn) logoutBtn.onclick = handleLogout;
            if (tabSearch) tabSearch.onclick = () => { state.activeTab = 'search'; render(); };
            if (tabClients) tabClients.onclick = () => { state.activeTab = 'clients'; render(); };
            if (searchBtn) searchBtn.onclick = performSearch;

            // Filters
            const filterComune = document.getElementById('filter-comune');
            const filterTipologia = document.getElementById('filter-tipologia');
            const filterPrezzoMin = document.getElementById('filter-prezzo-min');
            const filterPrezzoMax = document.getElementById('filter-prezzo-max');

            if (filterComune) filterComune.oninput = (e) => { state.filters.comune = e.target.value; };
            if (filterTipologia) filterTipologia.onchange = (e) => { state.filters.tipologia = e.target.value; };
            if (filterPrezzoMin) filterPrezzoMin.oninput = (e) => { state.filters.prezzoMin = e.target.value; };
            if (filterPrezzoMax) filterPrezzoMax.oninput = (e) => { state.filters.prezzoMax = e.target.value; };
        }

        function handleLogin() {
            if (state.password === MASTER_PASSWORD) {
                state.isAuthenticated = true;
                state.password = '';
                render();
            } else {
                alert('Password non corretta');
            }
        }

        function handleLogout() {
            state.isAuthenticated = false;
            state.searchResults = [];
            render();
        }

       // Sostituisci la funzione performSearch() con questa versione mock:
async function performSearch() {
    state.isLoading = true;
    state.searchStatus = 'üîç Ricerca in corso...';
    render();
    
    // Simula delay server
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    // Dati di esempio
    state.searchResults = [
        {
            tipologia: "Appartamento",
            indirizzo: "Via Garibaldi 45",
            comune: state.filters.comune || "Milano",
            prezzo: 450000,
            descrizione: "Appartamento di prestigio in zona centrale, 120 mq con giardino",
            dataAsta: "2024-04-15",
            fonte: "Immobiliare.it",
            link: "https://www.immobiliare.it/annuncio-123"
        },
        {
            tipologia: "Villa",
            indirizzo: "Via Monte Bianco 12",
            comune: state.filters.comune || "Torino",
            prezzo: 850000,
            descrizione: "Villa indipendente con piscina, 250 mq su due livelli",
            dataAsta: "2024-04-20",
            fonte: "Casa.it",
            link: "https://www.casa.it/annuncio-456"
        }
    ];
    
    state.isLoading = false;
    state.searchStatus = `‚úÖ Trovati ${state.searchResults.length} annunci (demo)`;
    render();
}

        // Inizializza app
        render();
    </script>
</body>
</html>
